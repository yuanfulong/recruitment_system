<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½æ‹›è˜åŠ©æ‰‹ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .hover-lift { transition: all 0.2s; }
        .hover-lift:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0,0,0,0.15); }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-50">
    <div id="app"></div>

    <script>
        // ==================== API é…ç½® ====================
       const API_URL = window.location.origin;

        // é…ç½® axios è·¨åŸŸ
        axios.defaults.headers.common['Access-Control-Allow-Origin'] = '*';

        // ==================== åº”ç”¨çŠ¶æ€ ====================
        let appState = {
            currentPage: 'dashboard',
            positions: [],
            candidates: [],
            selectedCandidate: null,
            selectedPosition: null,
            queryResult: null,
            loading: false,
            message: null,
        };

        // ==================== API è°ƒç”¨ ====================

        async function fetchPositions() {
            try {
                const response = await axios.get(`${API_URL}/api/positions`);
                appState.positions = response.data.positions || [];
                render();
            } catch (error) {
                showMessage('è·å–å²—ä½åˆ—è¡¨å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function fetchCandidates() {
            try {
                const response = await axios.get(`${API_URL}/api/candidates?limit=100`);
                appState.candidates = response.data.candidates || [];
                render();
            } catch (error) {
                showMessage('è·å–å€™é€‰äººåˆ—è¡¨å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function getCandidateDetail(id) {
            try {
                const response = await axios.get(`${API_URL}/api/candidates/${id}`);
                appState.selectedCandidate = response.data;
                appState.currentPage = 'candidateDetail';
                render();
            } catch (error) {
                showMessage('è·å–å€™é€‰äººè¯¦æƒ…å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function getPositionCandidates(positionId) {
            try {
                const response = await axios.get(`${API_URL}/api/positions/${positionId}/candidates?min_grade=C`);
                appState.selectedPosition = response.data;
                appState.currentPage = 'positionDetail';
                render();
            } catch (error) {
                showMessage('è·å–å²—ä½å€™é€‰äººå¤±è´¥: ' + error.message, 'error');
            }
        }

        async function uploadResume(file) {
            try {
                appState.loading = true;
                render();

                showMessage('ğŸ“¤ æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...', 'info');
                await new Promise(r => setTimeout(r, 500));

                const formData = new FormData();
                formData.append('file', file);

                showMessage('ğŸ”„ æ­£åœ¨æå–ç®€å†ä¿¡æ¯...', 'info');
                const response = await axios.post(`${API_URL}/api/candidates/upload`, formData, {
                    headers: { 'Content-Type': 'multipart/form-data' }
                });

                if (response.data.status === 'error') {
                    showMessage(`âŒ ä¸Šä¼ å¤±è´¥: ${response.data.message}`, 'error');
                    appState.loading = false;
                    render();
                    return;
                }

                showMessage(`âœ… ç®€å†å·²ä¸Šä¼ ï¼${response.data.name} è¢«åˆ†é…åˆ° ${response.data.auto_matched_position} å²—ä½`, 'success');
                await new Promise(r => setTimeout(r, 2000));
                await fetchCandidates();
                appState.currentPage = 'dashboard';
            } catch (error) {
                showMessage('âŒ ä¸Šä¼ ç®€å†å¤±è´¥: ' + (error.response?.data?.detail || error.message), 'error');
            } finally {
                appState.loading = false;
                render();
            }
        }

        async function createPosition(name, description) {
            try {
                appState.loading = true;
                render();

                showMessage('ğŸ”„ æ­£åœ¨åˆ›å»ºå²—ä½...', 'info');
                await new Promise(r => setTimeout(r, 500));

                const response = await axios.post(`${API_URL}/api/positions`, {
                    name,
                    description,
                    required_skills: [],
                    nice_to_have: []
                });

                if (response.data.status === 'error') {
                    showMessage(`âŒ åˆ›å»ºå¤±è´¥: ${response.data.message}`, 'error');
                    appState.loading = false;
                    render();
                    return;
                }

                showMessage(`âœ… å²—ä½ "${name}" åˆ›å»ºæˆåŠŸï¼æ­£åœ¨è¿›è¡Œå€™é€‰äººé‡æ–°åˆ†é…...`, 'success');
                await new Promise(r => setTimeout(r, 1500));
                await fetchPositions();
                appState.currentPage = 'dashboard';
            } catch (error) {
                showMessage('âŒ åˆ›å»ºå²—ä½å¤±è´¥: ' + (error.response?.data?.detail || error.message), 'error');
            } finally {
                appState.loading = false;
                render();
            }
        }

        async function queryByNaturalLanguage(query) {
            try {
                appState.loading = true;
                render();

                showMessage('ğŸ” æ­£åœ¨ç†è§£æŸ¥è¯¢...', 'info');
                await new Promise(r => setTimeout(r, 500));

                const response = await axios.post(`${API_URL}/api/query`, { query });

                if (response.data.error) {
                    showMessage(`âŒ æŸ¥è¯¢å¤±è´¥: ${response.data.error}`, 'error');
                    appState.loading = false;
                    render();
                    return;
                }

                appState.queryResult = response.data;
                appState.currentPage = 'queryResult';
                showMessage(`âœ… æŸ¥è¯¢å®Œæˆï¼æ‰¾åˆ° ${response.data.total} æ¡ç»“æœ`, 'success');
                render();
            } catch (error) {
                showMessage('âŒ æŸ¥è¯¢å¤±è´¥: ' + (error.response?.data?.detail || error.message), 'error');
            } finally {
                appState.loading = false;
            }
        }

        // ==================== æ¶ˆæ¯æ˜¾ç¤º ====================

        function showMessage(msg, type = 'info') {
            appState.message = { text: msg, type };
            render();
            setTimeout(() => {
                appState.message = null;
                render();
            }, 4000);
        }

        // ==================== é¡µé¢ç»„ä»¶ ====================

        function TopBar() {
            return `
                <div class="bg-white border-b border-gray-200 shadow-sm">
                    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
                        <div class="flex items-center cursor-pointer" onclick="appState.currentPage='dashboard'; render();">
                            <i class="fas fa-robot text-2xl text-blue-600 mr-3"></i>
                            <h1 class="text-2xl font-bold text-gray-900">æ™ºèƒ½æ‹›è˜åŠ©æ‰‹</h1>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="appState.currentPage='dashboard'; render();"
                                class="px-4 py-2 rounded-lg font-semibold transition ${appState.currentPage === 'dashboard' ? 'bg-blue-600 text-white' : 'text-gray-700 hover:bg-gray-100'}">
                                <i class="fas fa-home mr-2"></i>é¦–é¡µ
                            </button>
                            <button onclick="fetchPositions(); fetchCandidates();"
                                class="px-4 py-2 rounded-lg font-semibold text-gray-700 hover:bg-gray-100 transition">
                                <i class="fas fa-sync mr-2"></i>åˆ·æ–°
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function MessageBox() {
            if (!appState.message) return '';

            const bgColor = appState.message.type === 'success' ? 'bg-green-100 border-green-400 text-green-800' :
                           appState.message.type === 'error' ? 'bg-red-100 border-red-400 text-red-800' :
                           'bg-blue-100 border-blue-400 text-blue-800';

            const icon = appState.message.type === 'success' ? 'check-circle' :
                        appState.message.type === 'error' ? 'exclamation-circle' :
                        'info-circle';

            return `
                <div class="fixed top-20 right-4 p-4 rounded-lg border ${bgColor} shadow-lg fade-in z-50 max-w-sm">
                    <div class="flex items-center">
                        <i class="fas fa-${icon} mr-3"></i>
                        <span>${appState.message.text}</span>
                    </div>
                </div>
            `;
        }

        // ==================== é¦–é¡µ ====================

        function DashboardPage() {
            return `
                <div class="max-w-7xl mx-auto px-4 py-8">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-900 mb-2">ğŸ“Š æ•°æ®æ¦‚è§ˆ</h2>
                        <p class="text-gray-600">å®æ—¶æŸ¥çœ‹æ‹›è˜ç³»ç»Ÿçš„è¿è¥æ•°æ®</p>
                    </div>

                    <!-- ç»Ÿè®¡å¡ç‰‡ -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                        <div class="bg-white rounded-lg shadow p-6 hover-lift">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm mb-1">æ´»è·ƒå²—ä½</p>
                                    <p class="text-3xl font-bold text-blue-600">${appState.positions.length}</p>
                                </div>
                                <i class="fas fa-briefcase text-4xl text-blue-100"></i>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow p-6 hover-lift">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm mb-1">å€™é€‰äººæ€»æ•°</p>
                                    <p class="text-3xl font-bold text-green-600">${appState.candidates.length}</p>
                                </div>
                                <i class="fas fa-users text-4xl text-green-100"></i>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow p-6 hover-lift">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm mb-1">Açº§å€™é€‰äºº</p>
                                    <p class="text-3xl font-bold text-purple-600">${appState.candidates.filter(c => c.auto_matched_score >= 86).length}</p>
                                </div>
                                <i class="fas fa-star text-4xl text-purple-100"></i>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow p-6 hover-lift">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm mb-1">åŒ¹é…æˆåŠŸç‡</p>
                                    <p class="text-3xl font-bold text-orange-600">${appState.candidates.length > 0 ? Math.round(appState.candidates.filter(c => c.auto_matched_score > 60).length / appState.candidates.length * 100) : 0}%</p>
                                </div>
                                <i class="fas fa-chart-line text-4xl text-orange-100"></i>
                            </div>
                        </div>
                    </div>

                    <!-- å¿«é€Ÿæ“ä½œ -->
                    <div class="bg-white rounded-lg shadow p-8 mb-8">
                        <h3 class="text-2xl font-bold text-gray-900 mb-6">ğŸš€ å¿«é€Ÿæ“ä½œ</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button onclick="appState.currentPage='uploadResume'; render();"
                                class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-4 rounded-lg font-bold hover:shadow-lg transition flex items-center justify-center text-lg">
                                <i class="fas fa-upload mr-3"></i> ä¸Šä¼ ç®€å†
                            </button>
                            <button onclick="appState.currentPage='createPosition'; render();"
                                class="bg-gradient-to-r from-green-600 to-green-700 text-white px-6 py-4 rounded-lg font-bold hover:shadow-lg transition flex items-center justify-center text-lg">
                                <i class="fas fa-plus mr-3"></i> åˆ›å»ºå²—ä½
                            </button>
                            <button onclick="appState.currentPage='queryPage'; render();"
                                class="bg-gradient-to-r from-purple-600 to-purple-700 text-white px-6 py-4 rounded-lg font-bold hover:shadow-lg transition flex items-center justify-center text-lg">
                                <i class="fas fa-search mr-3"></i> æ™ºèƒ½æŸ¥è¯¢
                            </button>
                            <button onclick="appState.currentPage='candidates'; render();"
                                class="bg-gradient-to-r from-orange-600 to-orange-700 text-white px-6 py-4 rounded-lg font-bold hover:shadow-lg transition flex items-center justify-center text-lg">
                                <i class="fas fa-list mr-3"></i> æŸ¥çœ‹å€™é€‰äºº
                            </button>
                        </div>
                    </div>

                    <!-- å²—ä½åˆ—è¡¨ -->
                    <div class="bg-white rounded-lg shadow p-8">
                        <h3 class="text-2xl font-bold text-gray-900 mb-6">ğŸ“‹ å²—ä½ä¸€è§ˆ</h3>
                        ${appState.positions.length === 0 ?
                            '<p class="text-gray-500 text-center py-8">æš‚æ— å²—ä½ï¼Œè¯·åˆ›å»ºæ–°å²—ä½</p>' :
                            `<div class="grid gap-4">
                                ${appState.positions.map(pos => `
                                    <div class="border border-gray-200 rounded-lg p-6 hover-lift cursor-pointer" onclick="getPositionCandidates(${pos.position_id})">
                                        <div class="flex justify-between items-start mb-3">
                                            <h4 class="text-lg font-bold text-gray-900">${pos.name}</h4>
                                            <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-bold">${pos.total_candidates}äºº</span>
                                        </div>
                                        <p class="text-gray-600 text-sm mb-3">${pos.description.substring(0, 100) || 'æš‚æ— æè¿°'}...</p>
                                        <div class="flex gap-2 text-xs text-gray-500">
                                            <span class="px-2 py-1 bg-gray-100 rounded">Açº§: ${pos.grade_distribution?.A || 0}</span>
                                            <span class="px-2 py-1 bg-gray-100 rounded">Bçº§: ${pos.grade_distribution?.B || 0}</span>
                                            <span class="px-2 py-1 bg-gray-100 rounded">Cçº§: ${pos.grade_distribution?.C || 0}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>`
                        }
                    </div>
                </div>
            `;
        }

        // ==================== ä¸Šä¼ ç®€å†é¡µ ====================

        function UploadResumePage() {
            return `
                <div class="max-w-2xl mx-auto px-4 py-8">
                    <div class="flex items-center gap-4 mb-8">
                        <button onclick="appState.currentPage='dashboard'; render();" class="text-blue-600 hover:text-blue-800 text-2xl">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h2 class="text-3xl font-bold text-gray-900">ğŸ“„ ä¸Šä¼ ç®€å†</h2>
                    </div>

                    <div class="bg-white rounded-lg shadow p-8">
                        <div class="border-4 border-dashed border-blue-300 rounded-lg p-12 text-center hover:bg-blue-50 transition cursor-pointer"
                             id="dropZone" onclick="if(!appState.loading) document.getElementById('fileInput').click();">
                            <i class="fas fa-cloud-upload-alt text-6xl mb-4 ${appState.loading ? 'fa-spin text-gray-400' : 'text-blue-600'}"></i>
                            <p class="text-xl text-gray-900 font-bold mb-2">${appState.loading ? 'å¤„ç†ä¸­...' : 'æ‹–æ‹½ PDF ç®€å†æˆ–ç‚¹å‡»é€‰æ‹©'}</p>
                            <p class="text-gray-600">æ”¯æŒPDFæ ¼å¼ï¼Œå•ä¸ªæ–‡ä»¶æœ€å¤§ 10MB</p>
                            <input type="file" id="fileInput" accept=".pdf" style="display:none;" ${appState.loading ? 'disabled' : ''}
                                   onchange="if(this.files[0] && !appState.loading) uploadResume(this.files[0]);">
                        </div>

                        <div class="mt-8 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-600 rounded-lg">
                            <p class="text-gray-900 font-bold mb-3">âœ¨ ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š</p>
                            <ul class="text-gray-700 space-y-2">
                                <li>âœ“ æå–ç®€å†ä¸­çš„ä¸ªäººä¿¡æ¯ã€æŠ€èƒ½å’Œå·¥ä½œç»å†</li>
                                <li>âœ“ åˆ†ææ±‚èŒæ„å‘å’ŒèŒä½åŒ¹é…éœ€æ±‚</li>
                                <li>âœ“ å¯¹æ‰€æœ‰å¼€æ”¾å²—ä½è¿›è¡Œæ™ºèƒ½è¯„åˆ†</li>
                                <li>âœ“ æ¨èæœ€åŒ¹é…çš„å²—ä½</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        // ==================== åˆ›å»ºå²—ä½é¡µ ====================

        function CreatePositionPage() {
            return `
                <div class="max-w-2xl mx-auto px-4 py-8">
                    <div class="flex items-center gap-4 mb-8">
                        <button onclick="appState.currentPage='dashboard'; render();" class="text-blue-600 hover:text-blue-800 text-2xl">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h2 class="text-3xl font-bold text-gray-900">â• åˆ›å»ºæ–°å²—ä½</h2>
                    </div>

                    <div class="bg-white rounded-lg shadow p-8">
                        <form onsubmit="event.preventDefault();
                                 const name = document.getElementById('posName').value;
                                 const desc = document.getElementById('posDesc').value;
                                 if(name && desc) createPosition(name, desc);">

                            <div class="mb-6">
                                <label class="block text-gray-700 font-bold mb-3 text-lg">å²—ä½åç§° *</label>
                                <input type="text" id="posName" required
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 transition text-lg"
                                    placeholder="ä¾‹å¦‚ï¼šé«˜çº§Pythonå¼€å‘å·¥ç¨‹å¸ˆ">
                            </div>

                            <div class="mb-6">
                                <label class="block text-gray-700 font-bold mb-3 text-lg">å²—ä½æè¿° *</label>
                                <textarea id="posDesc" required rows="6"
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-600 transition text-lg"
                                    placeholder="è¯¦ç»†æè¿°å²—ä½çš„èŒè´£ã€è¦æ±‚ã€è–ªèµ„èŒƒå›´ç­‰..."></textarea>
                                <p class="text-gray-600 text-sm mt-2">æè¿°è¶Šè¯¦ç»†ï¼ŒåŒ¹é…è¶Šå‡†ç¡®</p>
                            </div>

                            <button type="submit" class="w-full bg-gradient-to-r from-green-600 to-green-700 text-white py-3 rounded-lg font-bold text-lg hover:shadow-lg transition"
                                    ${appState.loading ? 'disabled opacity-50' : ''}>
                                ${appState.loading ? '<i class="fas fa-spinner fa-spin mr-2"></i>å¤„ç†ä¸­...' : '<i class="fas fa-check mr-2"></i>åˆ›å»ºå²—ä½'}
                            </button>
                        </form>

                        <div class="mt-8 p-6 bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-green-600 rounded-lg">
                            <p class="text-gray-900 font-bold mb-2">ğŸ¯ æ–°å²—ä½åˆ›å»ºåä¼šè‡ªåŠ¨ï¼š</p>
                            <ul class="text-gray-700 space-y-1 text-sm">
                                <li>âœ“ æ‰«ææ‰€æœ‰å€™é€‰äººç®€å†</li>
                                <li>âœ“ ä½¿ç”¨AIè¯„ä¼°åŒ¹é…åº¦</li>
                                <li>âœ“ è‡ªåŠ¨é‡æ–°åˆ†é…æ›´ä¼˜å²—ä½</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        // ==================== æ™ºèƒ½æŸ¥è¯¢é¡µ ====================

        function QueryPage() {
            return `
                <div class="max-w-2xl mx-auto px-4 py-8">
                    <div class="flex items-center gap-4 mb-8">
                        <button onclick="appState.currentPage='dashboard'; render();" class="text-blue-600 hover:text-blue-800 text-2xl">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h2 class="text-3xl font-bold text-gray-900">ğŸ” æ™ºèƒ½æŸ¥è¯¢</h2>
                    </div>

                    <div class="bg-white rounded-lg shadow p-8">
                        <form onsubmit="event.preventDefault();
                                 const query = document.getElementById('queryInput').value;
                                 if(query) queryByNaturalLanguage(query);">

                            <div class="mb-6">
                                <label class="block text-gray-700 font-bold mb-3 text-lg">ç”¨ä¸­æ–‡æé—® *</label>
                                <textarea id="queryInput" required rows="4"
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-purple-600 transition text-lg"
                                    placeholder="ä¾‹å¦‚ï¼š&#10;â€¢ ç»™æˆ‘æ‰€æœ‰Pythonå²—ä½çš„Açº§å€™é€‰äºº&#10;â€¢ ç»Ÿè®¡å„ç­‰çº§å€™é€‰äººçš„æ•°é‡&#10;â€¢ å“ªäº›å€™é€‰äººæœ‰æ˜ç¡®çš„æ±‚èŒæ„å‘"></textarea>
                            </div>

                            <button type="submit" class="w-full bg-gradient-to-r from-purple-600 to-purple-700 text-white py-3 rounded-lg font-bold text-lg hover:shadow-lg transition"
                                    ${appState.loading ? 'disabled opacity-50' : ''}>
                                ${appState.loading ? '<i class="fas fa-spinner fa-spin mr-2"></i>æŸ¥è¯¢ä¸­...' : '<i class="fas fa-search mr-2"></i>æŸ¥è¯¢'}
                            </button>
                        </form>

                        <div class="mt-8 grid grid-cols-2 gap-4">
                            <div class="p-4 bg-purple-50 border-l-4 border-purple-600 rounded-lg">
                                <p class="font-bold text-gray-900 mb-2">ğŸ“Œ æŸ¥è¯¢ç¤ºä¾‹</p>
                                <ul class="text-sm text-gray-700 space-y-1">
                                    <li>â€¢ Pythonå²—ä½çš„å€™é€‰äºº</li>
                                    <li>â€¢ Açº§ä»¥ä¸Šå€™é€‰äºº</li>
                                    <li>â€¢ æ€»äººæ•°ç»Ÿè®¡</li>
                                </ul>
                            </div>
                            <div class="p-4 bg-purple-50 border-l-4 border-purple-600 rounded-lg">
                                <p class="font-bold text-gray-900 mb-2">ğŸ’¡ æç¤º</p>
                                <ul class="text-sm text-gray-700 space-y-1">
                                    <li>â€¢ æ”¯æŒè‡ªç„¶è¯­è¨€</li>
                                    <li>â€¢ AIæ™ºèƒ½ç†è§£</li>
                                    <li>â€¢ å®æ—¶æ•°æ®åˆ†æ</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ==================== å€™é€‰äººåˆ—è¡¨é¡µ ====================

        function CandidatesPage() {
            return `
                <div class="max-w-6xl mx-auto px-4 py-8">
                    <div class="flex items-center gap-4 mb-8">
                        <button onclick="appState.currentPage='dashboard'; render();" class="text-blue-600 hover:text-blue-800 text-2xl">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h2 class="text-3xl font-bold text-gray-900">ğŸ‘¥ å€™é€‰äººåˆ—è¡¨</h2>
                    </div>

                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        ${appState.candidates.length === 0 ?
                            '<p class="text-gray-500 text-center py-12 text-lg">æš‚æ— å€™é€‰äºº</p>' :
                            `<div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gradient-to-r from-gray-100 to-gray-50">
                                        <tr class="border-b-2 border-gray-200">
                                            <th class="px-6 py-4 text-left text-gray-900 font-bold">å§“å</th>
                                            <th class="px-6 py-4 text-left text-gray-900 font-bold">å¹´é¾„</th>
                                            <th class="px-6 py-4 text-left text-gray-900 font-bold">åˆ†é…å²—ä½</th>
                                            <th class="px-6 py-4 text-center text-gray-900 font-bold">è¯„åˆ†</th>
                                            <th class="px-6 py-4 text-center text-gray-900 font-bold">çŠ¶æ€</th>
                                            <th class="px-6 py-4 text-center text-gray-900 font-bold">æ“ä½œ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${appState.candidates.map((candidate, idx) => `
                                            <tr class="border-b hover:bg-blue-50 transition ${idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'}">
                                                <td class="px-6 py-4 text-gray-900 font-semibold">${candidate.name}</td>
                                                <td class="px-6 py-4 text-gray-600">${candidate.age || '-'}</td>
                                                <td class="px-6 py-4 text-gray-600">${candidate.auto_matched_position || '-'}</td>
                                                <td class="px-6 py-4 text-center">
                                                    <span class="inline-block px-3 py-1 rounded-full text-sm font-bold
                                                        ${candidate.auto_matched_score >= 86 ? 'bg-green-100 text-green-800' :
                                                          candidate.auto_matched_score >= 76 ? 'bg-blue-100 text-blue-800' :
                                                          candidate.auto_matched_score >= 60 ? 'bg-yellow-100 text-yellow-800' :
                                                          'bg-red-100 text-red-800'}">
                                                        ${candidate.auto_matched_score || 0}
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4 text-center">
                                                    ${candidate.is_position_locked ?
                                                        '<span class="inline-block text-xs px-2 py-1 bg-purple-100 text-purple-800 rounded font-semibold">ğŸ”’ å·²é”å®š</span>' :
                                                        candidate.no_matched_position ?
                                                        '<span class="inline-block text-xs px-2 py-1 bg-orange-100 text-orange-800 rounded font-semibold">â³ å¾…åŒ¹é…</span>' :
                                                        '<span class="inline-block text-xs px-2 py-1 bg-green-100 text-green-800 rounded font-semibold">âœ“ æ­£å¸¸</span>'}
                                                </td>
                                                <td class="px-6 py-4 text-center">
                                                    <button onclick="getCandidateDetail(${candidate.candidate_id})"
                                                        class="text-blue-600 hover:text-blue-800 font-semibold hover:underline">
                                                        æŸ¥çœ‹è¯¦æƒ…
                                                    </button>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>`
                        }
                    </div>
                </div>
            `;
        }

        // ==================== å€™é€‰äººè¯¦æƒ…é¡µ ====================

        function CandidateDetailPage() {
            const c = appState.selectedCandidate;
            return `
                <div class="max-w-4xl mx-auto px-4 py-8">
                    <div class="flex items-center gap-4 mb-8">
                        <button onclick="appState.currentPage='candidates'; render();" class="text-blue-600 hover:text-blue-800 text-2xl">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h2 class="text-3xl font-bold text-gray-900">å€™é€‰äººè¯¦æƒ…</h2>
                    </div>

                    <div class="bg-white rounded-lg shadow p-8">
                        <div class="flex justify-between items-start mb-8 pb-8 border-b-2">
                            <div>
                                <h1 class="text-4xl font-bold text-gray-900 mb-2">${c.name}</h1>
                                <p class="text-gray-600 text-lg mb-4">${c.email || 'æœªæä¾›'} | ${c.phone || 'æœªæä¾›'}</p>
                                <div class="flex gap-4">
                                    <span class="px-4 py-2 bg-gray-100 text-gray-900 rounded-lg font-semibold">å¹´é¾„: ${c.age || '-'}</span>
                                    <span class="px-4 py-2 bg-blue-100 text-blue-900 rounded-lg font-semibold">è´¨é‡: ${(c.extraction_quality || 0).toFixed(0)}%</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-6xl font-bold text-blue-600">${c.auto_matched_position_score || c.auto_matched_score || 0}</p>
                                <p class="text-gray-600 text-lg">ç»¼åˆè¯„åˆ†</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-3 gap-4 mb-8 p-6 bg-gray-50 rounded-lg">
                            <div>
                                <p class="text-gray-600 text-sm mb-1">åˆ†é…å²—ä½</p>
                                <p class="text-xl font-bold text-gray-900">${c.auto_matched_position || 'æœªåˆ†é…'}</p>
                            </div>
                            <div>
                                <p class="text-gray-600 text-sm mb-1">æ±‚èŒæ„å‘</p>
                                <p class="text-xl font-bold text-gray-900">${c.explicit_position || 'æ— '}</p>
                            </div>
                            <div>
                                <p class="text-gray-600 text-sm mb-1">å²—ä½çŠ¶æ€</p>
                                <p class="text-xl font-bold text-gray-900">
                                    ${c.is_position_locked ? 'ğŸ”’ å·²é”å®š' : c.no_matched_position ? 'â³ å¾…åŒ¹é…' : 'âœ“ æ­£å¸¸'}
                                </p>
                            </div>
                        </div>

                        <h3 class="text-2xl font-bold text-gray-900 mb-6">å„å²—ä½åŒ¹é…åº¦è¯„åˆ†</h3>
                        <div class="space-y-4">
                            ${c.positions.map(pos => `
                                <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-blue-400 transition">
                                    <div class="flex justify-between items-center mb-3">
                                        <div>
                                            <p class="font-bold text-gray-900 text-lg">${pos.position_name}</p>
                                            <p class="text-sm text-gray-600">ç­‰çº§: ${pos.grade}</p>
                                        </div>
                                        <span class="text-2xl font-bold text-blue-600">${pos.score}/100</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 h-3 rounded-full" style="width: ${Math.min(pos.score, 100)}%"></div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // ==================== å²—ä½è¯¦æƒ…é¡µ ====================

        function PositionDetailPage() {
            const p = appState.selectedPosition;
            return `
                <div class="max-w-4xl mx-auto px-4 py-8">
                    <div class="flex items-center gap-4 mb-8">
                        <button onclick="appState.currentPage='dashboard'; render();" class="text-blue-600 hover:text-blue-800 text-2xl">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h2 class="text-3xl font-bold text-gray-900">å²—ä½è¯¦æƒ…</h2>
                    </div>

                    <div class="bg-white rounded-lg shadow p-8 mb-8">
                        <h1 class="text-4xl font-bold text-gray-900 mb-4">${p.position_name}</h1>
                        <div class="flex gap-4 flex-wrap">
                            <span class="px-4 py-2 bg-blue-100 text-blue-900 rounded-lg font-bold">å€™é€‰äºº: ${p.total_candidates}ä½</span>
                            <span class="px-4 py-2 bg-green-100 text-green-900 rounded-lg font-bold">Açº§: ${p.candidates.filter(c => c.grade === 'A').length}ä½</span>
                            <span class="px-4 py-2 bg-yellow-100 text-yellow-900 rounded-lg font-bold">Bçº§: ${p.candidates.filter(c => c.grade === 'B').length}ä½</span>
                            <span class="px-4 py-2 bg-orange-100 text-orange-900 rounded-lg font-bold">Cçº§: ${p.candidates.filter(c => c.grade === 'C').length}ä½</span>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-8">
                        <h2 class="text-2xl font-bold text-gray-900 mb-6">å€™é€‰äººåˆ—è¡¨</h2>
                        ${p.candidates.length === 0 ?
                            '<p class="text-gray-500 text-center py-8 text-lg">æš‚æ— ç¬¦åˆæ¡ä»¶çš„å€™é€‰äºº</p>' :
                            `<div class="space-y-3">
                                ${p.candidates.map(cand => `
                                    <div class="flex items-center justify-between p-5 border-2 border-gray-200 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition cursor-pointer"
                                         onclick="getCandidateDetail(${cand.candidate_id})">
                                        <div class="flex-1">
                                            <h3 class="font-bold text-gray-900 text-lg">${cand.name}</h3>
                                            <p class="text-sm text-gray-600 mt-2">${cand.evaluation_reason}</p>
                                        </div>
                                        <span class="ml-4 px-4 py-2 rounded-full text-sm font-bold
                                            ${cand.grade === 'A' ? 'bg-green-100 text-green-800' :
                                              cand.grade === 'B' ? 'bg-blue-100 text-blue-800' :
                                              cand.grade === 'C' ? 'bg-yellow-100 text-yellow-800' :
                                              'bg-red-100 text-red-800'}">
                                            ${cand.grade}çº§ - ${cand.score}åˆ†
                                        </span>
                                    </div>
                                `).join('')}
                            </div>`
                        }
                    </div>
                </div>
            `;
        }

        // ==================== æŸ¥è¯¢ç»“æœé¡µ ====================

        function QueryResultPage() {
            const result = appState.queryResult;
            return `
                <div class="max-w-4xl mx-auto px-4 py-8">
                    <div class="flex items-center gap-4 mb-8">
                        <button onclick="appState.currentPage='queryPage'; render();" class="text-blue-600 hover:text-blue-800 text-2xl">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h2 class="text-3xl font-bold text-gray-900">æŸ¥è¯¢ç»“æœ</h2>
                    </div>

                    <div class="bg-white rounded-lg shadow p-8 mb-6">
                        <p class="text-gray-600 mb-3">æ‚¨çš„æŸ¥è¯¢ï¼š</p>
                        <p class="text-xl text-gray-900 italic font-semibold mb-6">"${result.query}"</p>

                        ${result.summary ?
                            `<div class="p-6 bg-gradient-to-r from-purple-50 to-indigo-50 border-l-4 border-purple-600 rounded-lg">
                                <p class="text-gray-900 font-bold mb-3">ğŸ¤– AI åˆ†æç»“æœï¼š</p>
                                <p class="text-gray-700 leading-relaxed">${result.summary}</p>
                            </div>` : ''
                        }
                    </div>

                    <div class="bg-white rounded-lg shadow p-8">
                        <h2 class="text-2xl font-bold text-gray-900 mb-6">è¯¦ç»†æ•°æ®</h2>
                        ${result.results.length === 0 ?
                            '<p class="text-gray-500 text-center py-8 text-lg">æœªæ‰¾åˆ°åŒ¹é…ç»“æœ</p>' :
                            `<div class="space-y-3">
                                ${result.results.map(item => `
                                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:bg-blue-50 transition">
                                        <p class="font-bold text-gray-900">${item.candidate_name || item.metric || item.position_name || 'æ•°æ®é¡¹'}</p>
                                        <div class="flex gap-4 mt-2 text-sm text-gray-600">
                                            ${item.score ? `<span>è¯„åˆ†: <strong class="text-gray-900">${item.score}</strong></span>` : ''}
                                            ${item.grade ? `<span>ç­‰çº§: <strong class="text-gray-900">${item.grade}</strong></span>` : ''}
                                            ${item.value ? `<span>æ•°å€¼: <strong class="text-gray-900">${item.value}</strong></span>` : ''}
                                            ${item.email ? `<span>é‚®ç®±: <strong class="text-gray-900">${item.email}</strong></span>` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>`
                        }
                    </div>
                </div>
            `;
        }

        // ==================== ä¸»æ¸²æŸ“å‡½æ•° ====================

        function render() {
            let content;
            switch(appState.currentPage) {
                case 'uploadResume': content = UploadResumePage(); break;
                case 'createPosition': content = CreatePositionPage(); break;
                case 'queryPage': content = QueryPage(); break;
                case 'candidates': content = CandidatesPage(); break;
                case 'candidateDetail': content = CandidateDetailPage(); break;
                case 'positionDetail': content = PositionDetailPage(); break;
                case 'queryResult': content = QueryResultPage(); break;
                default: content = DashboardPage();
            }

            document.getElementById('app').innerHTML = TopBar() + MessageBox() + content;
        }

        // ==================== åˆå§‹åŒ– ====================

        document.addEventListener('DOMContentLoaded', () => {
            fetchPositions();
            fetchCandidates();
            render();
        });
    </script>
</body>
</html>